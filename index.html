import React, { useState, useRef, useEffect } from 'react';
import {
  Home, BookOpen, Download, HelpCircle, Settings,
  ChevronRight, Star, Moon, Quote, Sun, Heart,
  ArrowLeft, MapPin, Clock, Users, Target, Book, Map,
  ChevronsRight, ChevronDown, Search, ArrowRight, ArrowLeft as ArrowLeftIcon,
  Swords, CheckCircle, XCircle, Award, RotateCw, Lightbulb,
  FileText, DownloadCloud, Bell, MessageSquare, Info, Shield,
  Minus, Plus, Text, Send
  } from 'lucide-react';

import eventsData from './src/data/events.js';
import stories from './src/data/stories.js';
import quizQuestions from './src/data/quiz.js';
import downloadItems from './src/data/downloads.js';

// Components
const Button = ({ children, className, onClick, ...props }) => (
  <button
    className={`px-4 py-2 rounded-lg transition-all duration-300 flex items-center justify-center ${className}`}
    onClick={onClick}
    {...props}
  >
    {children}
  </button>
);

const Card = ({ children, className }) => (
  <div className={`rounded-lg ${className}`}>
    {children}
  </div>
);

const CardContent = ({ children, className }) => (
  <div className={className}>
    {children}
  </div>
);

// Search Bar Component with Autocomplete
const SearchBar = () => {
  const [query, setQuery] = useState('');
  const [suggestions, setSuggestions] = useState([]);
  const searchRef = useRef(null);

  useEffect(() => {
    const handleClickOutside = (event) => {
      if (searchRef.current && !searchRef.current.contains(event.target)) {
        setSuggestions([]);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => {
      document.removeEventListener("mousedown", handleClickOutside);
    };
  }, [searchRef]);

  const handleInputChange = (e) => {
    const value = e.target.value;
    setQuery(value);

    if (value.length > 1) {
      const lowercasedValue = value.toLowerCase();
        const filteredSuggestions = eventsData.filter(event =>
        event.title.toLowerCase().includes(lowercasedValue) ||
        event.subtitle.toLowerCase().includes(lowercasedValue) ||
        event.location.toLowerCase().includes(lowercasedValue) ||
        event.parties_involved.some(party => party.toLowerCase().includes(lowercasedValue))
      );
      setSuggestions(filteredSuggestions);
    } else {
      setSuggestions([]);
    }
  };

  const handleSuggestionClick = (suggestionTitle) => {
    setQuery(suggestionTitle);
    setSuggestions([]);
  };

  return (
    <div className="py-12 bg-[#E5E7EB] flex justify-center">
      <div className="relative w-full max-w-xl px-4" ref={searchRef}>
        <div className="relative">
          <input
            type="text"
            placeholder="Cari peristiwa, tokoh, atau tempat..."
            className="w-full py-4 pl-12 pr-28 rounded-2xl text-[#A67C52] bg-[#E5E7EB] focus:outline-none placeholder-[#B99B7E]"
            style={{
              boxShadow: 'inset 8px 8px 16px #bebebe, inset -8px -8px 16px #ffffff'
            }}
            value={query}
            onChange={handleInputChange}
          />
          <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-6 h-6 text-[#B99B7E]" />
          <Button
            className="absolute right-2 top-1/2 -translate-y-1/2 bg-[#E5E7EB] hover:bg-[#D1D5DB] text-[#A67C52] text-sm font-semibold rounded-lg py-2"
            style={{
              boxShadow: '4px 4px 8px #bebebe, -4px -4px 8px #ffffff'
            }}
          >
            Cari
          </Button>
        </div>
        {suggestions.length > 0 && (
          <ul
            className="absolute z-10 w-[calc(100%-2rem)] mt-2 bg-[#F3F4F6] rounded-2xl"
            style={{
              boxShadow: '8px 8px 16px #bebebe, -8px -8px 16px #ffffff'
            }}
          >
            {suggestions.map(suggestion => (
              <li
                key={suggestion.id}
                className="p-4 cursor-pointer hover:bg-[#E5E7EB] rounded-2xl text-[#A67C52]"
                onClick={() => handleSuggestionClick(suggestion.title)}
              >
                <p className="font-bold">{suggestion.title}</p>
                <p className="text-sm text-gray-600">{suggestion.subtitle}</p>
              </li>
            ))}
          </ul>
        )}
      </div>
    </div>
  );
};


// Hero Section Component
const HeroSection = () => {
  return (
    <section className="h-[45vh] bg-gradient-to-br from-[#E5E7EB] via-[#F3F4F6] to-[#E5E7EB] flex items-center justify-center relative overflow-hidden">
      {/* Floating decorative elements */}
      <div className="absolute inset-0 overflow-hidden">
        {[...Array(15)].map((_, i) => (
          <div
            key={i}
            className="absolute opacity-20 animate-pulse"
            style={{
              left: `${Math.random() * 100}%`,
              top: `${Math.random() * 100}%`,
              animationDelay: `${i * 0.2}s`,
              animationDuration: `${3 + Math.random() * 2}s`
            }}
          >
            {i % 3 === 0 ? (
              <Star className="w-3 h-3 text-[#A67C52]" />
            ) : (
              <Moon className="w-2 h-2 text-[#B99B7E]" />
            )}
          </div>
        ))}
      </div>

      <div className="container mx-auto px-4 text-center relative z-10 max-w-4xl">
        {/* Main Title */}
        <div>
          <h1 className="text-4xl md:text-6xl font-serif text-[#A67C52] mb-2 tracking-wide leading-tight">
            الأرجوزة المئية
          </h1>
          <div className="text-3xl md:text-5xl font-serif text-[#A67C52] mb-3">
            Jejak Cahaya
          </div>
        </div>

        {/* Subtitle */}
        <p className="text-lg md:text-xl text-gray-700 max-w-2xl mx-auto leading-relaxed">
          "Jejak Kehidupan Sang Utusan"
          <br />
          <span className="text-base md:text-lg text-gray-700 italic opacity-80">
            Menelusuri perjalanan hidup Rasulullah ﷺ
          </span>
        </p>
      </div>
    </section>
  );
};

// Stories Section Component
const StoriesSection = () => {

  return (
    <section className="py-20 bg-gradient-to-b from-[#E5E7EB] to-[#F3F4F6]">
      <div className="container mx-auto px-4">
        <div className="text-center mb-16">
          <h2 className="text-4xl md:text-5xl lg:text-6xl font-serif text-[#A67C52] mb-6">
            Kisah Favorit
          </h2>
          <p className="text-xl text-gray-700 max-w-2xl mx-auto">
            Cerita-cerita menginspirasi dari perjalanan hidup Rasulullah ﷺ
          </p>
        </div>

        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
          {stories.map((story, index) => (
            <div
              key={index}
              className="group cursor-pointer"
            >
              <Card
                className="bg-[#E5E7EB] border-none overflow-hidden transition-all duration-300 hover:scale-105"
                style={{
                  boxShadow: '12px 12px 24px #bebebe, -12px -12px 24px #ffffff'
                }}
              >
                <div className="h-48 relative overflow-hidden">
                  <img
                    src={story.image}
                    alt={story.title}
                    className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                  />
                  <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent" />
                  
                  <div className="absolute top-3 left-3 bg-black/60 text-white px-3 py-1 rounded-full text-xs font-semibold">
                    {story.year}
                  </div>

                  <div className="absolute bottom-4 left-4">
                    <div
                      className="bg-white/90 p-3 rounded-xl"
                      style={{
                        boxShadow: '4px 4px 8px rgba(0,0,0,0.1)'
                      }}
                    >
                      <story.icon className="w-8 h-8 text-[#A67C52]" />
                    </div>
                  </div>
                </div>
                <CardContent className="p-6">
                  <h3 className="text-2xl font-bold text-[#A67C52] mb-3 group-hover:text-[#B99B7E] transition-colors">
                    {story.title}
                  </h3>
                  <p className="text-gray-700 leading-relaxed mb-4 text-sm">
                    {story.description}
                  </p>
                  <Button
                    className="w-full bg-[#F3F4F6] hover:bg-[#A67C52] text-[#A67C52] hover:text-white border-none transition-all duration-300"
                    style={{
                      boxShadow: '6px 6px 12px #bebebe, -6px -6px 12px #ffffff'
                    }}
                  >
                    Baca Selengkapnya
                  </Button>
                </CardContent>
              </Card>
            </div>
          ))}
        </div>

        <div className="text-center mt-12">
          <Button
            className="bg-[#A67C52] hover:bg-[#936A45] text-white px-8 py-4 rounded-2xl text-lg transition-all duration-300"
            style={{
              boxShadow: '8px 8px 16px #bebebe, -8px -8px 16px #ffffff'
            }}
          >
            Lihat Semua Kisah
          </Button>
        </div>
      </div>
    </section>
  );
};

// Quote Section Component
const QuoteSection = () => {
  return (
    <section className="py-20 bg-[#F3F4F6] relative overflow-hidden">
      {/* Background Ornaments */}
      <div className="absolute inset-0 opacity-10">
        {[...Array(8)].map((_, i) => (
          <div
            key={i}
            className="absolute animate-spin"
            style={{
              left: `${Math.random() * 100}%`,
              top: `${Math.random() * 100}%`,
              animationDuration: `${15 + i * 2}s`,
              animationDirection: i % 2 === 0 ? 'normal' : 'reverse'
            }}
          >
            <BookOpen className="w-6 h-6 text-[#A67C52]" />
          </div>
        ))}
      </div>

      <div className="container mx-auto px-4 relative z-10">
        <div className="max-w-4xl mx-auto text-center">
          <div
            className="bg-[#E5E7EB] p-12 rounded-3xl"
            style={{
              boxShadow: '16px 16px 32px #bebebe, -16px -16px 32px #ffffff'
            }}
          >
            <div className="mb-8">
              <Quote className="w-16 h-16 text-[#B99B7E] mx-auto mb-6" />
            </div>

            <div className="mb-8">
              <h2 className="text-3xl md:text-4xl lg:text-5xl font-serif text-[#A67C52] mb-6 leading-relaxed">
                لَقَدْ كَانَ فِي قَصَصِهِمْ عِبْرَةٌ لِأُولِي الْأَلْبَابِ
              </h2>
              <p className="text-2xl md:text-3xl text-gray-700 font-medium mb-4">
                "Sungguh, pada kisah-kisah mereka terdapat pelajaran bagi orang-orang yang berakal."
              </p>
              <p className="text-lg text-gray-700 opacity-80">
                (QS. Yusuf: 111)
              </p>
            </div>

            <div
              className="bg-[#F3F4F6] p-6 rounded-2xl"
              style={{
                boxShadow: 'inset 8px 8px 16px #bebebe, inset -8px -8px 16px #ffffff'
              }}
            >
              <p className="text-gray-700 text-lg italic leading-relaxed">
                "Ibrah dari sejarah adalah jembatan antara masa lalu dan masa depan. Karena setiap kejadian memiliki pola berulang. Cara pintas merusak umat adalah dengan mencabut generasi dari sejarah kebesarannya dan wilayah geografis kejayaan Islam, maka muncullah generasi yang malu pada Islam sebagai identitasnya."
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>
  );
};

// Event Detail Component
const EventDetail = ({ event, onBack }) => {
  const mapImage = event.map_image_url || 'https://images.unsplash.com/photo-1563426472338-3c666e5a4853?q=80&w=1964&auto=format&fit=crop';

  return (
    <div
      className="p-6 bg-[#E5E7EB] rounded-2xl space-y-6"
      style={{
        boxShadow: 'inset 8px 8px 16px #bebebe, inset -8px -8px 16px #ffffff'
      }}
    >
      <Button
        onClick={onBack}
        className="bg-[#F3F4F6] border-none text-[#A67C52] mb-4 hover:bg-[#E5E7EB]"
        style={{
          boxShadow: '6px 6px 12px #bebebe, -6px -6px 12px #ffffff'
        }}
      >
        <ArrowLeft className="w-4 h-4 mr-2" />
        Kembali ke Daftar
      </Button>

      <div>
        <p className="text-sm text-gray-700 opacity-80">
          {event.hijri_year === 0 ? "Sebelum Hijrah" : `${event.hijri_year} H`} / {event.gregorian_year} M - {event.gregorian_month}
        </p>
        <h2 className="text-3xl font-bold text-[#A67C52] mt-1">{event.title}</h2>
        <h3 className="text-xl font-semibold text-gray-600">{event.subtitle}</h3>
      </div>

      <div className="grid md:grid-cols-2 gap-4 text-base">
        <div className="flex items-start gap-3">
          <MapPin className="w-5 h-5 text-[#A67C52] mt-1 flex-shrink-0" />
          <div>
            <strong className="block text-gray-600">Tempat:</strong>
            <span className="text-gray-700">{event.location}</span>
          </div>
        </div>
        <div className="flex items-start gap-3">
          <Clock className="w-5 h-5 text-[#A67C52] mt-1 flex-shrink-0" />
          <div>
            <strong className="block text-gray-600">Durasi:</strong>
            <span className="text-gray-700">{event.duration}</span>
          </div>
        </div>
      </div>

      <div>
        <h4 className="font-bold text-lg text-gray-600 mb-2">Deskripsi Peristiwa</h4>
        <p className="text-gray-700 leading-relaxed text-base">{event.description}</p>
      </div>

      {mapImage && (
        <div>
          <h4 className="font-bold text-lg text-gray-600 mb-2 flex items-center gap-2">
            <Map className="w-5 h-5 text-[#A67C52]" />
            Visualisasi Peta
          </h4>
          <div
            className="rounded-xl overflow-hidden"
            style={{
              boxShadow: '8px 8px 16px #bebebe, -8px -8px 16px #ffffff'
            }}
          >
            <img
              src={mapImage}
              alt={`Peta untuk ${event.title}`}
              className="w-full h-auto object-cover"
            />
          </div>
        </div>
      )}

      <div>
        <h4 className="font-bold text-lg text-gray-600 mb-2 flex items-center gap-2">
          <Users className="w-5 h-5 text-[#A67C52]" />
          Pihak Terlibat
        </h4>
        <ul className="list-disc list-inside space-y-1 text-gray-700 text-base">
          {event.parties_involved?.map((party, i) => (
            <li key={i}>{party}</li>
          ))}
        </ul>
      </div>
      
      <div>
        <h4 className="font-bold text-lg text-gray-600 mb-2 flex items-center gap-2">
          <Target className="w-5 h-5 text-[#A67C52]" />
          Fakta Menarik
        </h4>
        <p
          className="text-gray-700 italic bg-[#E5E7EB] p-4 rounded-lg text-base"
          style={{
            boxShadow: 'inset 4px 4px 8px #bebebe, inset -4px -4px 8px #ffffff'
          }}
        >
          {event.fun_fact}
        </p>
      </div>
      
      <div>
        <h4 className="font-bold text-lg text-gray-600 mb-2 flex items-center gap-2">
          <Book className="w-5 h-5 text-[#A67C52]" />
          Referensi
        </h4>
        <ul className="list-decimal list-inside space-y-1 text-gray-700 text-sm">
          {event.references?.map((ref, i) => (
            <li key={i}>{ref}</li>
          ))}
        </ul>
      </div>
    </div>
  );
};

// Timeline Page Component
  const TimelinePage = () => {
    const [events] = useState(eventsData);
  const [selectedYear, setSelectedYear] = useState(5);
  const [selectedEvent, setSelectedEvent] = useState(null);
  
  const years = ["Sebelum H", ...Array.from({ length: 11 }, (_, i) => i + 1)];
  
  const handleYearSelect = (year) => {
    setSelectedYear(year === "Sebelum H" ? 0 : year);
    setSelectedEvent(null);
  };

  const filteredEvents = events.filter(e => e.hijri_year === selectedYear);

  return (
    <div className="py-12 md:py-20 px-4 container mx-auto bg-[#E5E7EB] min-h-screen">
      <div className="text-center mb-12">
        <h1 className="text-4xl md:text-5xl lg:text-6xl font-serif text-[#A67C52] mb-4">
          Timeline Sejarah
        </h1>
        <p className="text-xl text-gray-700 max-w-2xl mx-auto">
          Jelajahi peristiwa-peristiwa penting dari kehidupan Rasulullah ﷺ.
        </p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
        {/* Mobile Dropdown */}
        <div className="md:hidden mb-6">
          <div
            className="bg-[#E5E7EB] p-4 rounded-2xl"
            style={{
              boxShadow: '8px 8px 16px #bebebe, -8px -8px 16px #ffffff'
            }}
          >
            <h3 className="font-bold text-lg text-[#A67C52] mb-4 text-center">
              Pilih Tahun Hijriyah
            </h3>
            <select
              value={selectedYear === 0 ? "Sebelum H" : selectedYear.toString()}
              onChange={(e) => handleYearSelect(e.target.value === "Sebelum H" ? "Sebelum H" : parseInt(e.target.value))}
              className="w-full bg-[#F3F4F6] border-none text-[#A67C52] font-semibold p-3 rounded-lg"
              style={{
                boxShadow: 'inset 4px 4px 8px #bebebe, inset -4px -4px 8px #ffffff'
              }}
            >
              {years.map((year) => (
                <option key={year} value={year.toString()}>
                  {year} {year !== "Sebelum H" && "Hijriyah"}
                </option>
              ))}
            </select>
          </div>
        </div>

        {/* Desktop Sidebar */}
        <aside className="hidden md:block md:col-span-1">
          <div
            className="sticky top-20 bg-[#E5E7EB] p-4 rounded-2xl"
            style={{
              boxShadow: '8px 8px 16px #bebebe, -8px -8px 16px #ffffff'
            }}
          >
            <h3 className="font-bold text-lg text-[#A67C52] mb-4 text-center">
              Tahun Hijriyah
            </h3>
            <div className="space-y-2">
              {years.map((year) => {
                const isActive = (selectedYear === year || (selectedYear === 0 && year === "Sebelum H"));
                return (
                  <button
                    key={year}
                    onClick={() => handleYearSelect(year)}
                    className={`w-full text-left p-3 rounded-xl transition-all duration-300 font-semibold text-[#B99B7E] ${
                      isActive ? 'text-[#A67C52]' : ''
                    }`}
                    style={{
                      boxShadow: isActive
                        ? 'inset 4px 4px 8px #bebebe, inset -4px -4px 8px #ffffff'
                        : '4px 4px 8px #bebebe, -4px -4px 8px #ffffff'
                    }}
                  >
                    {year} {year !== "Sebelum H" && "Hijriyah"}
                  </button>
                );
              })}
            </div>
          </div>
        </aside>

        {/* Main Content */}
        <main className="col-span-1 md:col-span-3">
          {selectedEvent ? (
            <EventDetail
              event={selectedEvent}
              onBack={() => setSelectedEvent(null)}
            />
          ) : (
            <div className="space-y-4">
              <h2 className="text-3xl font-bold text-[#A67C52] mb-4">
                Peristiwa Tahun {selectedYear === 0 ? "Sebelum Hijrah" : `${selectedYear} H`}
              </h2>
              {filteredEvents.length > 0 ? (
                filteredEvents.map(event => (
                  <button
                    key={event.id}
                    onClick={() => setSelectedEvent(event)}
                    className="w-full p-4 bg-[#E5E7EB] rounded-xl transition-all duration-300 flex items-center justify-between text-left hover:bg-[#D1D5DB]"
                    style={{
                      boxShadow: '8px 8px 16px #bebebe, -8px -8px 16px #ffffff'
                    }}
                  >
                    <div className="flex items-center gap-3">
                      <BookOpen className="w-6 h-6 text-[#A67C52] flex-shrink-0"/>
                      <span className="font-semibold text-gray-700">{event.title}</span>
                    </div>
                    <ChevronsRight className="w-5 h-5 text-[#B99B7E]"/>
                  </button>
                ))
              ) : (
                <p
                  className="text-center text-gray-700 p-8 bg-[#E5E7EB] rounded-2xl"
                  style={{
                    boxShadow: 'inset 8px 8px 16px #bebebe, inset -8px -8px 16px #ffffff'
                  }}
                >
                  Tidak ada data peristiwa untuk tahun ini.
                </p>
              )}
            </div>
          )}
        </main>
      </div>
    </div>
  );
};

// Quiz Page Component

const QuizPage = () => {
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [showResult, setShowResult] = useState(false);
  const [selectedAnswer, setSelectedAnswer] = useState(null);
  const [isCorrect, setIsCorrect] = useState(null);

  const handleAnswer = (option) => {
    if (selectedAnswer) return; // Mencegah pemilihan ulang

    setSelectedAnswer(option);
    const isAnswerCorrect = option === quizQuestions[currentQuestionIndex].correctAnswer;
    setIsCorrect(isAnswerCorrect);
    if (isAnswerCorrect) {
      setScore(score + 1);
    }
  };

  const handleNext = () => {
    const nextQuestion = currentQuestionIndex + 1;
    if (nextQuestion < quizQuestions.length) {
      setCurrentQuestionIndex(nextQuestion);
    } else {
      setShowResult(true);
    }
    setSelectedAnswer(null);
    setIsCorrect(null);
  };

  const restartQuiz = () => {
    setCurrentQuestionIndex(0);
    setScore(0);
    setShowResult(false);
    setSelectedAnswer(null);
    setIsCorrect(null);
  }

  return (
    <div className="py-12 md:py-20 px-4 container mx-auto bg-[#E5E7EB] min-h-screen flex flex-col items-center">
       <div className="text-center mb-12">
        <h1 className="text-4xl md:text-5xl lg:text-6xl font-serif text-[#A67C52] mb-4">
          Kuis Islami
        </h1>
        <p className="text-xl text-gray-700 max-w-2xl mx-auto">
          Uji pengetahuanmu tentang sejarah Islam!
        </p>
      </div>

      <div 
        className="w-full max-w-2xl bg-[#E5E7EB] p-6 md:p-8 rounded-2xl"
        style={{ boxShadow: '12px 12px 24px #bebebe, -12px -12px 24px #ffffff' }}
      >
        {showResult ? (
          <div className="text-center">
            <Award className="w-24 h-24 text-[#A67C52] mx-auto mb-6" />
            <h2 className="text-3xl font-bold text-[#A67C52] mb-4">Kuis Selesai!</h2>
            <p className="text-xl text-gray-700 mb-6">
              Skor akhir kamu: <span className="font-bold text-2xl text-[#A67C52]">{score}</span> dari {quizQuestions.length}
            </p>
            <Button 
              onClick={restartQuiz}
              className="bg-[#A67C52] hover:bg-[#936A45] text-white px-8 py-4 rounded-2xl text-lg transition-all duration-300"
              style={{ boxShadow: '8px 8px 16px #bebebe, -8px -8px 16px #ffffff' }}
            >
              <RotateCw className="w-5 h-5 mr-2" />
              Coba Lagi
            </Button>
          </div>
        ) : (
          <div>
            <div className="flex justify-between items-center mb-6 text-center">
                <p className="text-lg text-gray-700">Pertanyaan {currentQuestionIndex + 1}/{quizQuestions.length}</p>
                <p className="text-lg text-[#A67C52] font-semibold">Skor: {score}</p>
            </div>
            <h2 className="text-2xl md:text-3xl font-semibold text-[#A67C52] mt-2 text-center">
                {quizQuestions[currentQuestionIndex].question}
            </h2>
            
            <div className="space-y-4 mt-6">
              {quizQuestions[currentQuestionIndex].options.map((option, index) => {
                const isSelected = selectedAnswer === option;
                let buttonClass = 'bg-[#E5E7EB] hover:bg-[#D1D5DB] text-[#A67C52]';
                if (isSelected) {
                  buttonClass = isCorrect ? 'bg-green-300 text-green-800' : 'bg-red-300 text-red-800';
                }

                return (
                  <Button
                    key={index}
                    onClick={() => handleAnswer(option)}
                    disabled={selectedAnswer !== null}
                    className={`w-full text-lg p-4 justify-start ${buttonClass}`}
                    style={{ boxShadow: '8px 8px 16px #bebebe, -8px -8px 16px #ffffff' }}
                  >
                    {isSelected && (isCorrect ? <CheckCircle className="mr-3"/> : <XCircle className="mr-3"/>)}
                    {option}
                  </Button>
                );
              })}
            </div>

            {selectedAnswer && (
              <div className="mt-6">
                <div 
                  className="p-4 bg-[#F3F4F6] rounded-lg transition-opacity duration-500"
                  style={{ boxShadow: 'inset 4px 4px 8px #bebebe, inset -4px -4px 8px #ffffff' }}
                >
                  <div className="flex items-center font-bold text-[#A67C52]">
                    <Lightbulb className="w-5 h-5 mr-2" />
                    <h4>Penjelasan</h4>
                  </div>
                  <p className="text-gray-700 mt-2">
                    {quizQuestions[currentQuestionIndex].explanation}
                  </p>
                </div>
                <div className="text-right mt-6">
                  <Button
                      onClick={handleNext}
                      className="bg-[#A67C52] hover:bg-[#936A45] text-white px-6 py-3 rounded-xl text-lg"
                      style={{ boxShadow: '8px 8px 16px #bebebe, -8px -8px 16px #ffffff' }}
                  >
                      {currentQuestionIndex < quizQuestions.length - 1 ? 'Berikutnya' : 'Lihat Hasil'}
                      <ArrowRight className="w-5 h-5 ml-2" />
                  </Button>
                </div>
              </div>
            )}
          </div>
        )}
      </div>
    </div>
  );
};

// Download Page Component

const DownloadPage = () => {
  return (
    <div className="py-12 md:py-20 px-4 container mx-auto bg-[#E5E7EB] min-h-screen">
      <div className="text-center mb-12">
        <h1 className="text-4xl md:text-5xl lg:text-6xl font-serif text-[#A67C52] mb-4">
          Materi Unduhan
        </h1>
        <p className="text-xl text-gray-700 max-w-2xl mx-auto">
          Unduh materi-materi bermanfaat dalam format PDF.
        </p>
      </div>

      <div className="space-y-6 max-w-4xl mx-auto">
        {downloadItems.map(item => (
          <div 
            key={item.id}
            className="bg-[#E5E7EB] p-6 rounded-2xl flex flex-col md:flex-row items-center gap-6"
            style={{ boxShadow: '12px 12px 24px #bebebe, -12px -12px 24px #ffffff' }}
          >
            <div 
              className="flex-shrink-0 p-5 rounded-2xl"
              style={{ boxShadow: 'inset 8px 8px 16px #bebebe, inset -8px -8px 16px #ffffff' }}
            >
              <FileText className="w-16 h-16 text-[#A67C52]" />
            </div>
            <div className="flex-grow text-center md:text-left">
              <h3 className="text-2xl font-bold text-[#A67C52]">{item.title}</h3>
              <p className="text-gray-700 mt-1 text-sm">{item.description}</p>
              <p className="text-xs text-gray-600 mt-2 opacity-80">PDF | {item.fileSize}</p>
            </div>
            <a 
              href={item.fileUrl} 
              download
              className="w-full md:w-auto bg-[#A67C52] hover:bg-[#936A45] text-white px-6 py-3 rounded-xl text-base transition-all duration-300 flex items-center justify-center flex-shrink-0"
              style={{ boxShadow: '8px 8px 16px #bebebe, -8px -8px 16px #ffffff' }}
            >
              <DownloadCloud className="w-5 h-5 mr-2"/>
              Unduh
            </a>
          </div>
        ))}
      </div>
    </div>
  );
};

// Settings Page Component
const SettingsPage = ({ textSize, onTextSizeChange }) => {
    const [notifications, setNotifications] = useState(true);
    const [openFaq, setOpenFaq] = useState(null);
    const [feedback, setFeedback] = useState('');
    const [feedbackSent, setFeedbackSent] = useState(false);

    const faqItems = [
        { q: "Dari mana sumber data aplikasi ini?", a: "Data sejarah dalam aplikasi ini diambil dari kitab-kitab Sirah Nabawiyah yang mu'tabar seperti Sirah Ibnu Hisyam dan Ar-Rahiq Al-Makhtum." },
        { q: "Apakah aplikasi ini gratis?", a: "Ya, aplikasi ini sepenuhnya gratis dan dibuat untuk tujuan edukasi dan dakwah." },
        { q: "Bagaimana cara melaporkan jika ada kesalahan data?", a: "Anda dapat menggunakan formulir 'Kritik & Saran' di bawah ini untuk melaporkan kesalahan atau memberikan masukan." }
    ];

    const handleFeedbackSubmit = (e) => {
        e.preventDefault();
        if(feedback.trim() === '') return;
        console.log("Feedback submitted:", feedback);
        setFeedbackSent(true);
        setFeedback('');
        setTimeout(() => setFeedbackSent(false), 3000);
    };

    return (
        <div className="py-12 md:py-20 px-4 container mx-auto bg-[#E5E7EB] min-h-screen">
            <div className="text-center mb-12">
                <h1 className="text-4xl md:text-5xl lg:text-6xl font-serif text-[#A67C52] mb-4">
                    Pengaturan
                </h1>
                <p className="text-xl text-gray-700 max-w-2xl mx-auto">
                    Sesuaikan preferensi aplikasi Anda.
                </p>
            </div>

            <div className="max-w-4xl mx-auto space-y-10">
                {/* General Settings */}
                <div className="bg-[#E5E7EB] p-6 rounded-2xl" style={{ boxShadow: '12px 12px 24px #bebebe, -12px -12px 24px #ffffff' }}>
                    <h2 className="text-2xl font-bold text-[#A67C52] mb-6">Umum</h2>
                    
                    {/* Text Size */}
                    <div className="flex flex-col sm:flex-row justify-between items-center mb-4 p-4 rounded-lg" style={{boxShadow: 'inset 6px 6px 12px #bebebe, inset -6px -6px 12px #ffffff'}}>
                        <div className="flex items-center text-gray-700 mb-3 sm:mb-0">
                            <Text className="w-6 h-6 mr-3" />
                            <span className="font-semibold">Ukuran Teks</span>
                        </div>
                        <div className="flex items-center gap-2">
                            <Button onClick={() => onTextSizeChange('sm')} className={`p-2 rounded-full ${textSize === 'sm' ? 'bg-[#D1D5DB]' : 'bg-[#E5E7EB]'}`} style={{boxShadow: '4px 4px 8px #bebebe, -4px -4px 8px #ffffff'}}><span className="text-xs font-bold">A</span></Button>
                            <Button onClick={() => onTextSizeChange('base')} className={`p-2 rounded-full ${textSize === 'base' ? 'bg-[#D1D5DB]' : 'bg-[#E5E7EB]'}`} style={{boxShadow: '4px 4px 8px #bebebe, -4px -4px 8px #ffffff'}}><span className="text-base font-bold">A</span></Button>
                            <Button onClick={() => onTextSizeChange('lg')} className={`p-2 rounded-full ${textSize === 'lg' ? 'bg-[#D1D5DB]' : 'bg-[#E5E7EB]'}`} style={{boxShadow: '4px 4px 8px #bebebe, -4px -4px 8px #ffffff'}}><span className="text-lg font-bold">A</span></Button>
                        </div>
                    </div>

                    {/* Notifications */}
                    <div className="flex justify-between items-center p-4 rounded-lg" style={{boxShadow: 'inset 6px 6px 12px #bebebe, inset -6px -6px 12px #ffffff'}}>
                        <div className="flex items-center text-gray-700">
                            <Bell className="w-6 h-6 mr-3" />
                            <span className="font-semibold">Notifikasi</span>
                        </div>
                        <button onClick={() => setNotifications(!notifications)} className={`relative w-14 h-8 rounded-full transition-colors duration-300 ${notifications ? 'bg-[#A67C52]' : 'bg-[#D1D5DB]'}`} style={{boxShadow: 'inset 4px 4px 8px #bebebe, inset -4px -4px 8px #ffffff'}}>
                            <span className={`absolute top-1 left-1 w-6 h-6 bg-white rounded-full transition-transform duration-300 ${notifications ? 'transform translate-x-6' : ''}`} style={{boxShadow: '2px 2px 4px #bebebe, -2px -2px 4px #ffffff'}}></span>
                        </button>
                    </div>
                </div>

                {/* FAQ */}
                <div className="bg-[#E5E7EB] p-6 rounded-2xl" style={{ boxShadow: '12px 12px 24px #bebebe, -12px -12px 24px #ffffff' }}>
                    <h2 className="text-2xl font-bold text-[#A67C52] mb-6">FAQ</h2>
                    <div className="space-y-4">
                        {faqItems.map((item, index) => (
                            <div key={index} className="rounded-lg overflow-hidden" style={{boxShadow: '8px 8px 16px #bebebe, -8px -8px 16px #ffffff'}}>
                                <button onClick={() => setOpenFaq(openFaq === index ? null : index)} className="w-full flex justify-between items-center p-4 bg-[#E5E7EB] text-[#A67C52] font-semibold">
                                    <span>{item.q}</span>
                                    <ChevronDown className={`w-5 h-5 transition-transform ${openFaq === index ? 'rotate-180' : ''}`} />
                                </button>
                                {openFaq === index && (
                                    <div className="p-4 bg-[#E5E7EB] text-gray-700" style={{boxShadow: 'inset 4px 4px 8px #bebebe, inset -4px -4px 8px #ffffff'}}>
                                        <p>{item.a}</p>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>

                {/* About Team */}
                <div className="bg-[#E5E7EB] p-6 rounded-2xl" style={{ boxShadow: '12px 12px 24px #bebebe, -12px -12px 24px #ffffff' }}>
                    <h2 className="text-2xl font-bold text-[#A67C52] mb-6">Tentang Tim</h2>
                    <div className="p-4 rounded-lg text-gray-700" style={{boxShadow: 'inset 6px 6px 12px #bebebe, inset -6px -6px 12px #ffffff'}}>
                        <p className="italic text-left text-[#A67C52]">Di antara jejak masa, kami menulis dengan asa.<br />Di antara cahaya ilmu, kami menjaga amanah tanpa ragu.</p>
                        
                        <div className="my-6 space-y-3 text-left">
                            <p><strong>Ustadz Nizar:</strong> Dewan syariat, yang menjaga jalur riwayat dan narasi tetap lurus sesuai shiroh nabi.</p>
                            <p><strong>Mbak Ratih:</strong> Menenun kata penuh hikmah, agar sejarah berkilau indah.</p>
                            <p><strong>Mbak Ella:</strong> Menulis dengan rasa, agar riwayat hidup kembali mempesona.</p>
                            <p><strong>Mbak Ifa:</strong> Merangkai aksara, agar perjalanan agung tak sirna.</p>
                            <p><strong>Mbak Veni:</strong> Menghadirkan makna, agar hikmah terpatri selamanya.</p>
                            <p><strong>Mbak Rini:</strong> Menorehkan tinta, agar setiap kisah tak pernah sirna.</p>
                            <p><strong>Mbak Ratna:</strong> Menyulam cerita, agar sirah hidup sepanjang masa.</p>
                            <p><strong>Mbak Dee:</strong> Mengalirkan narasi, agar kebenaran tegak tanpa henti.</p>
                            <p><strong>Pak Yudho:</strong> Merapikan bahasa, agar setiap kata berakhir dengan makna.</p>
                        </div>

                        <p className="italic text-center">Kami berpadu dalam satu tujuan,<br />Menghidupkan sirah sebagai tuntunan.<br />Bukan sekadar kenangan yang beku,<br />Melainkan cahaya yang membimbing waktu.</p>

                        <p className="mt-6 font-semibold text-[#A67C52] text-center">“Sejarah adalah cermin jiwa,<br />yang menatapnya akan menemukan cahaya.”</p>
                    </div>
                </div>


                {/* Feedback Form */}
                <div className="bg-[#E5E7EB] p-6 rounded-2xl" style={{ boxShadow: '12px 12px 24px #bebebe, -12px -12px 24px #ffffff' }}>
                    <h2 className="text-2xl font-bold text-[#A67C52] mb-6">Kritik & Saran</h2>
                    <form onSubmit={handleFeedbackSubmit}>
                        <textarea 
                            value={feedback}
                            onChange={(e) => setFeedback(e.target.value)}
                            rows="5"
                            placeholder="Tuliskan masukan Anda di sini..."
                            className="w-full p-4 rounded-2xl text-[#A67C52] bg-[#E5E7EB] focus:outline-none placeholder-[#B99B7E] resize-none"
                            style={{ boxShadow: 'inset 8px 8px 16px #bebebe, inset -8px -8px 16px #ffffff' }}
                        />
                        <div className="text-right mt-4">
                            <Button 
                                type="submit"
                                className="bg-[#A67C52] hover:bg-[#936A45] text-white px-6 py-3 rounded-xl text-base"
                                style={{ boxShadow: '8px 8px 16px #bebebe, -8px -8px 16px #ffffff' }}
                            >
                                <Send className="w-5 h-5 mr-2"/>
                                Kirim
                            </Button>
                        </div>
                        {feedbackSent && <p className="text-green-600 text-center mt-4">Terima kasih atas masukan Anda!</p>}
                    </form>
                </div>
            </div>
        </div>
    );
};


// Bottom Navigation Component
const BottomNavigation = ({ currentPage, onPageChange }) => {
  const navItems = [
    { icon: Home, label: "Home", page: "home" },
    { icon: BookOpen, label: "Timeline", page: "timeline" },
    { icon: HelpCircle, label: "Quiz", page: "quiz" },
    { icon: Download, label: "Download", page: "download" },
    { icon: Settings, label: "Setting", page: "settings" },
  ];

  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-[#E5E7EB]/90 backdrop-blur-md border-t border-[#bebebe] z-50">
      <div className="container mx-auto px-4">
        <div className="max-w-md mx-auto flex items-center justify-around py-2">
          {navItems.map((item) => {
            const isActive = currentPage === item.page;
            return (
              <button
                key={item.page}
                onClick={() => onPageChange(item.page)}
                className="flex flex-col items-center p-2 rounded-xl transition-all duration-300 w-16"
              >
                <div
                  className={`p-3 rounded-full transition-all duration-300 ${
                    isActive ? "bg-[#D1D5DB]" : ""
                  }`}
                  style={{
                    boxShadow: isActive
                      ? 'inset 4px 4px 8px #bebebe, inset -4px -4px 8px #ffffff'
                      : '4px 4px 8px #bebebe, -4px -4px 8px #ffffff'
                  }}
                >
                  <item.icon className={`w-6 h-6 transition-colors duration-300 text-[#A67C52]`} />
                </div>
                <span className={`text-xs font-medium mt-1 transition-colors duration-300 ${
                  isActive ? "text-[#A67C52]" : "text-[#B99B7E]"
                }`}>
                  {item.label}
                </span>
              </button>
            );
          })}
        </div>
      </div>
    </nav>
  );
};

// Main App Component
const App = () => {
  const [currentPage, setCurrentPage] = useState('home');
  const [textSize, setTextSize] = useState('base'); // 'sm', 'base', 'lg'
  const storiesRef = useRef(null);

  const handleScrollToStories = () => {
    if (storiesRef.current) {
      storiesRef.current.scrollIntoView({ behavior: 'smooth' });
    }
  };

  const renderCurrentPage = () => {
    switch (currentPage) {
      case 'home':
        return (
          <div>
            <HeroSection />
            <SearchBar />
            <div ref={storiesRef}>
              <StoriesSection />
            </div>
            <QuoteSection />
          </div>
        );
      case 'timeline':
        return <TimelinePage />;
      case 'quiz':
        return <QuizPage />;
      case 'download':
        return <DownloadPage />;
      case 'settings':
        return <SettingsPage textSize={textSize} onTextSizeChange={setTextSize} />;
      default:
        return (
          <div className="min-h-screen flex items-center justify-center bg-[#E5E7EB]">
            <div className="text-center p-8">
              <h2 className="text-3xl font-bold text-[#A67C52] mb-4">
                Halaman {currentPage.charAt(0).toUpperCase() + currentPage.slice(1)}
              </h2>
              <p className="text-gray-700">
                Fitur ini sedang dalam pengembangan
              </p>
            </div>
          </div>
        );
    }
  };

  return (
    <div className={`min-h-screen bg-[#E5E7EB] text-${textSize}`}>
      <main className="pb-24">
        {renderCurrentPage()}
      </main>
      
      <BottomNavigation
        currentPage={currentPage}
        onPageChange={setCurrentPage}
      />
    </div>
  );
};

export default App;
